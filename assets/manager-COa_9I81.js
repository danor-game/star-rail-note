import{_ as W,r as v,t as L,o as Y,w as Z,c as S,a as p,b as m,d as r,e as V,f,g as ee,h as E,u as n,C as U,F as x,i as k,j as le,k as te,l as se,m as ne,$ as B,D,p as ae,n as ie}from"./index-aSgyGGsL.js";import{M as u}from"./meta-Bit9qb41.js";import{T as H,l as j,s as oe}from"./load-profiles-Da-v77Nz.js";import{C as w}from"./combo-CXIuJESD.js";const N=_=>(ae("data-v-347bea34"),_=_(),ie(),_),ue={item:""},re=N(()=>r("br",null,null,-1)),ce={item:""},de=N(()=>r("p-label",null,"系列 ",-1)),pe=N(()=>r("br",null,null,-1)),me={item:""},ve=["doubled"],fe=["innerHTML"],he={key:0},ge=["innerHTML"],$e={__name:"manager",setup(_){const A=v(null);L.addTabHandle("achievement-manager",A),Y(()=>L.emitChanged("mounted"));const h=v(""),T=v({}),C=v(""),I=async()=>{const e=h.value;A.value&&(A.value.tipsTitle=`${A.value.title} ${e}`);try{const l=j().find(t=>t.uid==e);T.value=l?.infosPlayerAchievement$id||{},C.value=l?.name||"",localStorage.setItem("last-analysis-uid",e)}catch(l){B("获取成就记录",l)}};Z(A,e=>I(h.value=e.params?.[0]??h.value??""));const $=v(""),M=u.seriesAchievement.reduce((e,l,t)=>(e[l.id]=u.seriesAchievement.length-t,e),{}),K=S(()=>u.achievements.filter(e=>T.value[e.id]?.status==1&&(e.title.includes($.value)||e.desc.includes($.value))&&b.value.has(e.series)&&y.value.filter(l=>e.tags.includes(l)).length==y.value.length&&(c.value=="all"||e.tags.includes(`版本:${c.value}`))).sort((e,l)=>M[l.series]-M[e.series]||l.priority-e.priority)),R=S(()=>u.achievements.filter(e=>T.value[e.id]?.status!=1&&T.value[e.id]?.status!=2&&(e.title.includes($.value)||e.desc.includes($.value))&&b.value.has(e.series)&&y.value.filter(l=>e.tags.includes(l)).length==y.value.length&&(c.value=="all"||e.tags.includes(`版本:${c.value}`))).sort((e,l)=>M[l.series]-M[e.series]||l.priority-e.priority)),q=S(()=>[["未完成",R.value,1],["已完成",K.value,0]]),P=[{value:"all",text:"全部"},...u.versions.map(e=>({value:e,text:e}))],c=v("all"),b=v(new Set(u.seriesAchievement.map(e=>e.id))),z=(e,l)=>e.has(l)?e.delete(l):e.add(l),G=(e,l,t)=>e.has(l)?(t.forEach(a=>e.add(a)),e.delete(l)):(e.clear(),e.add(l)),J=(e,l)=>e.size?e.clear():l.forEach(t=>e.add(t)),O=(e,l=[])=>{let t=e.replace(/<\/?unbreak>/g,"").replace(/<\/?u>/g,"").replace(/\\n/g,"<br>").replace("{TEXTJOIN#54}",`<span style="color:var(--cMain);">${C.value}的扑满以太灵</span>`).replace("{NICKNAME}",`<span style="color:var(--cMain);">${C.value}</span>`);l.length&&(t=t.replace(/(?<!=)#(\d+)(?:\[([im])\](%?))?/g,(o,s,i,d)=>{let g=l[s-1];if(i=="i")d=="%"?g=`${(g*100).toFixed(0)}%`:g=g.toFixed(0);else if(i=="m")g=`${(g/1e4).toFixed(1)}万`;else if(i)throw`unknown format[${i}]`;return`<color=#F79646FF>${g}</color>`}));const a=t.split(/(?=<color=#[0-9a-fA-F]{8}>|<\/color>)|(?<=<color=#[0-9a-fA-F]{8}>|<\/color>)/);if(a.length>1){const o=[],s=[];for(const i of a){if(i=="</color>"){o.shift();continue}let[,d]=i.match(/<color=#([0-9a-fA-F]{8})>/)??[];if(d){o.unshift(d);continue}(d=o[0])?s.push(`<span style="color:#${d};">${i}</span>`):s.push(i)}t=s.join("")}return t},X=(e,l)=>{const t=j(),a=t.find(s=>s.uid==h.value);if(!a)return B("完成成就",`找不到档案[${h.value}]`);a.infosPlayerAchievement$id||(a.infosPlayerAchievement$id={}),a.infosPlayerAchievement$id[e]=Object.assign({},a.infosPlayerAchievement$id[e],{id:e,status:l,timeModify:D().unix()});const o=u.achievements.find(s=>s.id==e);for(const s of o?.idsAchievementExclusive||[])a.infosPlayerAchievement$id[s]=Object.assign({},a.infosPlayerAchievement$id[s],{id:s,status:l==0?0:l==1?2:0,timeModify:D().unix()});oe(t),I()},F=v(!0),y=v([]),Q=new Set(u.achievements.flatMap(e=>e.tags));return(e,l)=>(p(),m(x,null,[r("p-fixed-topbar",null,[r("p-label",ue,"● "+V(C.value),1),f(n(H),{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=t=>h.value=t),item:"",class:"!w-48",label:"UID",type:"number",align:"center","label-split":" ",onKeyup:ee(E(I,["exact"]),["enter"])},null,8,["modelValue","onKeyup"]),f(n(H),{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=t=>$.value=t),item:"",class:"!w-48",label:"搜索",align:"center","label-split":" "},null,8,["modelValue"]),f(n(w),{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=t=>c.value=t),item:"",class:"!w-36",lightcone4:"",label:"版本",align:"center","align-options":"left","label-split":" ",options:P},null,8,["modelValue"]),f(n(w),{modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=t=>c.value=t),item:"",class:"!w-36",lightcone4:"",label:"活动",align:"center","align-options":"left","label-split":" ",options:P},null,8,["modelValue"]),f(n(w),{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=t=>c.value=t),item:"",class:"!w-36",lightcone4:"",label:"稀有",align:"center","align-options":"left","label-split":" ",options:P},null,8,["modelValue"]),f(n(w),{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=t=>c.value=t),item:"",class:"!w-36",lightcone4:"",label:"难度",align:"center","align-options":"left","label-split":" ",options:P},null,8,["modelValue"]),f(n(U),{item:"",class:"!w-16",text:F.value?"双列":"单列",onClick:l[6]||(l[6]=t=>F.value=!F.value)},null,8,["text"]),re,r("p-series",ce,[de,(p(!0),m(x,null,k(n(u).seriesAchievement,t=>(p(),le(n(U),{key:`option-series-${t.id}`,"option-button":"",text:t.name,white:!b.value.has(t.id),onClick:[E(a=>z(b.value,t.id),["exact"]),E(a=>G(b.value,t.id,n(u).seriesAchievement.map(o=>o.id)),["ctrl"]),E(a=>J(b.value,n(u).seriesAchievement.map(o=>o.id)),["shift"])]},null,8,["text","white","onClick"]))),128))]),pe,r("p-tag-filter",me,[f(n(w),{modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=t=>y.value=t),class:"inblock",style:{width:"calc(100vw - 10rem)"},label:"标签","label-split":" ",options:[...n(Q)].sort(),"key-show":"$$","key-value":"$$","multi-select":"array",filter:""},null,8,["modelValue","options"])])]),r("p-main-box",{doubled:e.brop(F.value)},[(p(!0),m(x,null,k(q.value,([t,a,o])=>(p(),m("p-box",{key:`achievement-finishType-${t}`},[r("p-title",null,V(t)+" "+V(a.length),1),r("p-achievements",null,[(p(!0),m(x,null,k(a,s=>(p(),m("p-achievement",{key:`achievement-${s.id}`},[f(n(U),{"oper-button":"",text:o?"完成":"撤回",icon:o?n(te):n(se),onClick:i=>X(s.id,o)},null,8,["text","icon","onClick"]),r("p-title",null,"● "+V(O(s.title,s.paramsText)),1),r("p-desc",{innerHTML:O(s.desc,s.paramsText)},null,8,fe),r("p-tags",null,[(p(!0),m(x,null,k(s.tags,i=>(p(),m("p-tag",{key:`achievement-${s.id}-tag-${i}`},V(i),1))),128))]),s.idsAchievementExclusive?.length?(p(),m("p-exclusives",he,[(p(!0),m(x,null,k(s.idsAchievementExclusive,i=>(p(),m("p-exclusive",{key:`achievement-${s.id}-exclusive-${i}`,innerHTML:`【互斥成就】<span class='font-bold'>${n(u).achievements.find(d=>d.id==i).title}</span> ${O(n(u).achievements.find(d=>d.id==i).desc,n(u).achievements.find(d=>d.id==i).paramsText).replaceAll("<br>","")}`},null,8,ge))),128))])):ne("",!0)]))),128))])]))),128))],8,ve)],64))}},Ve=W($e,[["__scopeId","data-v-347bea34"]]);export{Ve as default};
