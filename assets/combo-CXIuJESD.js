import{_ as pe,c as r,s as N,r as i,w as V,o as ve,v as ye,a as p,b as v,u as o,x as c,m as I,y as g,e as F,d as y,g as x,h as $,f as J,z as me,A as he,B as ge,E as we,G as Se,F as Q,i as X,H as K,p as be,n as ke}from"./index-aSgyGGsL.js";import{p as Ve,a as xe,T as $e}from"./load-profiles-Da-v77Nz.js";const Ae=n=>(be("data-v-e674534f"),n=n(),ke(),n),Be=["checked"],Ce=["disabled"],De=["hide-outline","only"],Ne=["value","placeholder","tabindex","disabled","onKeypress"],Ie=["tabindex","onKeypress","onKeyup","onKeydown"],Fe=Ae(()=>y("p-tip",null,"搜索",-1)),Ke={key:0,selected:""},qe=["selected","title","onClick"],He=["first"],Me=["selected","title","focus-now","onClick"],Te={__name:"combo",props:{modelValue:{type:[String,Number,Boolean,Array],default:""},disable:{type:Boolean,default:!1},text:{type:String,default:""},default:{type:[String,Number,Boolean],default:""},disabling:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},...Ve,options:{type:Array,default:()=>[],required:!0},place:{type:[Number,String],default:""},tab:{type:[Number,String],default:0},align:{type:String,default:null},alignOptions:{type:String,default:null},filter:{type:[String,Boolean,Function],default:!1},multiSelect:{type:[Boolean,String],default:!1},keyShow:{type:[String,Function,Array],default:"text"},keyValue:{type:String,default:"value"},separatorValue:{type:String,default:","},separatorShow:{type:String,default:"、"},openSwitch:{type:Boolean,default:!1}},emits:["update:modelValue","update:disable","update:value"],setup(n,{emit:Y}){const a=n,A=Y,B=r(()=>a.multiSelect==="array"?a.multiSelect:N(a.multiSelect)),d=r(()=>N(a.disabling)),Z=r(()=>N(a.readonly)),{$label:q,$labelWidth:ee,$labelAlign:te}=xe(a,d),le=r(()=>({width:ee.value,textAlign:te.value})),m=i(d.value&&a.modelValue===!1?a.default:a.modelValue),s=i(d.value?a.modelValue===!1:a.disable);V(()=>a.disable,e=>{d.value||(s.value=e)}),V(()=>a.modelValue,e=>{d.value?e===!1?s.value=!0:(s.value=!1,m.value=e):m.value=e}),V([m,s],([e,l],[t,u])=>{d.value?(e!=t&&A("update:value",e),l!=u&&A("update:disable",l),A("update:modelValue",l===!0?!1:e)):A("update:modelValue",e)});const H=r(()=>{const e=m.value;return B.value?e instanceof Array?e.filter(l=>l):e?String(e).split(",").map(l=>l.trim()).filter(l=>l):[]:[e]}),z=e=>a.keyValue=="$$"?e:e?.[a.keyValue],M=(e,l)=>{const t=typeof l;return l===null||t=="undefined"||t=="boolean"?e===l:e==l},ae=e=>{const l=H.value,t=z(e);return{selected:B.value?!!~l.findIndex(u=>M(u,t)):M(l[0],t),value:t}},w=i(""),S=r(()=>typeof a.filter=="function"?a.filter:N(a.filter)),ne=(e,l,t)=>{const u=w.value?.trim()??"",k=S.value;return k?typeof k=="function"?k(u,e.data,e,l,t):h(e.data)?.includes(u):!0},U=r(()=>a.options),T=r(()=>U.value.map(e=>({data:e,...ae(e)}))),E=r(()=>T.value.filter(e=>e.selected)),b=r(()=>T.value.filter(e=>!e.selected).filter((e,l,t)=>ne(e,l,t)).filter(e=>!e.data?.hidden)),h=(e,l=0)=>{const t=a.keyShow instanceof Array?a.keyShow[l]:a.keyShow;return t=="$$"?e:typeof t=="function"?t(e)??"":e?.[t]??""},oe=r(()=>H.value.map(e=>h(U.value.find(l=>M(z(l),e)),1)).join(a.separatorShow)),L=i(null),G=i(null),O=i(null),C=i(null),P=i(""),R=i(""),D=i(!1),ue=()=>{D.value=!0,K(()=>S.value?W.value=!W.value:O.value.focus())},se=()=>{D.value=!1,K(()=>G.value.focus())},W=i(!1),_=()=>{if(s.value||Z.value)return;const e=C.value;document.querySelector(`#tippy-${e.id}`)?e.hide():(P.value="auto",R.value=window.getComputedStyle(L.value).width,e.show())},ie=e=>{e.selected=!0,m.value=e.value,C.value.hide()},j=e=>{if(B.value){e.selected=!e.selected;const l=e.value,t=new Set(H.value);t.has(l)?t.delete(l):t.add(l);const u=[...t];B.value=="array"?m.value=u:m.value=u.join(a.separatorValue)}else ie(e)};ve(()=>{C.value=ye(L.value,{placement:"bottom-start",content:O.value,allowHTML:!0,interactive:!0,animation:"",duration:[0,0],offset:[0,-2],trigger:"manual",maxWidth:"unset",onShow:ue,onHide:se})});const f=i(0),re=()=>{const e=b.value.length;f.value=(e+(f.value-1)%e)%e,K(()=>document.querySelector("p-option[focus-now]")?.scrollIntoView({behavior:"auto",block:"center"}))},ce=()=>{const e=b.value.length;f.value=(e+(f.value+1)%e)%e,K(()=>document.querySelector("p-option[focus-now]")?.scrollIntoView({behavior:"auto",block:"center"}))},de=()=>S.value&&w.value?w.value="":C.value.hide();V(b,e=>{f.value>=e.length&&(f.value=e.length-1)});const fe=()=>{const e=b.value[f.value];e&&j(e)};return V(()=>a.openSwitch,_),(e,l)=>(p(),v("comp-combo",null,[d.value?(p(),v("p-disabling",{key:0,checked:o(c)(!s.value),onClick:l[0]||(l[0]=t=>s.value=!s.value)},null,8,Be)):I("",!0),o(q)?(p(),v("p-label",{key:1,disabled:o(c)(s.value),style:g(le.value),onClick:l[1]||(l[1]=t=>d.value&&(s.value=!s.value))},F(o(q)),13,Ce)):I("",!0),y("p-value",{ref_key:"domValue",ref:L,"hide-outline":o(c)(D.value),only:o(c)(!d.value&&!o(q)),onClick:l[2]||(l[2]=t=>_())},[y("input",{ref_key:"domInput",ref:G,value:oe.value,style:g({textAlign:n.align}),placeholder:n.place,tabindex:n.tab,readonly:!0,disabled:o(c)(s.value),onKeypress:x($(_,["stop","prevent"]),["space"])},null,44,Ne),J(o(ge),{"drop-icon":"",disabled:o(c)(s.value),icon:D.value?o(me):o(he),"swap-opacity":"",class:"w-4"},null,8,["disabled","icon"])],8,De),y("p-drop",{ref_key:"domDrop",ref:O,tabindex:n.tab,style:g({width:P.value,minWidth:R.value}),onKeypress:x($(fe,["stop","prevent"]),["enter"]),onKeyup:x($(re,["stop","prevent"]),["up"]),onKeydown:[x($(ce,["stop","prevent"]),["down"]),x($(de,["stop","prevent"]),["esc"])]},[we(y("p-filter",null,[Fe,J($e,{modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=t=>w.value=t),filter:"","focus-switch":W.value},null,8,["modelValue","focus-switch"])],512),[[Se,S.value]]),E.value.length?(p(),v("p-options",Ke,[y("p-tip",null,F(S.value?E.value.length:"")+" 已选",1),(p(!0),v(Q,null,X(E.value,(t,u)=>(p(),v("p-option",{key:`combo-option-${u}`,selected:o(c)(t.selected),title:t.data?.[n.keyValue]??h(t.data),style:g({textAlign:n.alignOptions||n.align}),onClick:k=>j(t)},F(h(t.data)),13,qe))),128))])):I("",!0),y("p-options",null,[y("p-tip",{first:o(c)(f.value==0)},"未选",8,He),T.value.length?I("",!0):(p(),v("p-option",{key:0,style:g({textAlign:n.alignOptions||n.align}),disabled:""},"无可用选项",4)),(p(!0),v(Q,null,X(b.value,(t,u)=>(p(),v("p-option",{key:`combo-option-${u}`,selected:o(c)(t.selected),title:t.data?.[n.keyValue]??h(t.data),style:g({textAlign:n.alignOptions||n.align}),"focus-now":o(c)(f.value==u),onClick:k=>j(t)},F(h(t.data)),13,Me))),128))])],44,Ie)]))}},Oe=pe(Te,[["__scopeId","data-v-e674534f"]]);export{Oe as C};
