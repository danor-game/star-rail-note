import{_ as j,r as k,o as q,t as D,c as G,$ as E,a as n,b as v,d as l,f as x,u as R,C as M,q as c,e as I,F as V,i as C,j as S,m as N,p as O,n as W}from"./index-iDzqh3sp.js";import{M as i}from"./meta-eUFWZLzx.js";import{l as z,T as J}from"./load-profiles-j6jIeUOi.js";import T from"./gacha-item-_pkC4CQX.js";import F from"./pool-title-hZyji8Cz.js";import{C as L}from"./combo-jQnlAUzN.js";const K=(b,w,U)=>{const h={};h.typesPoolGacha=[];const g=i.typesPoolGacha.reduce((o,r)=>(o[r.id]=0,o),{});for(const o of i.typesPoolGacha.toReversed()){const r=b.filter(a=>a.type==o.id).sort((a,f)=>f.time-a.time),y=g[o.id];let p=g[o.id];for(const a of r.toReversed())g[o.id]++,i.items$id[a.item]?.rarity==5&&(a.countInvest=g[o.id],g[o.id]=0,y&&(a.countInvestPrev=p,p=0));h.typesPoolGacha.unshift({id:o.id,name:o.name,order:o.order,logs:r,logs5:r.filter(a=>i.items$id[a.item]?.rarity==5),logs4:r.filter(a=>i.items$id[a.item]?.rarity==4),logsRare:r.filter(a=>i.characters$id[a.item]?.rarity>=(w?4:5)||i.lightcones$id[a.item]?.rarity>=(U?4:5)),countInvestNext:g[o.id],countInvestPrev:y})}h.pools=[];const m=i.typesPoolGacha.reduce((o,r)=>(o[r.id]=0,o),{});for(const o of i.poolsGacha.filter(r=>!r.idLeader).toReversed()){const r=i.poolsGacha.filter(t=>t.idLeader==o.id),y=[o,...r],p=o.unknown?i.poolsGacha.map(t=>t.id):y.map(t=>t.id),a=y.map(t=>t.itemsBoost5??[]).flat(),f=o.unknown?b.filter(t=>!p.includes(t.pool)&&t.pool.startsWith(o.typeItem=="character"?"2":"3")).sort((t,$)=>$.time-t.time):b.filter(t=>p.includes(t.pool)).sort((t,$)=>$.time-t.time),A=m[o.type];let B=m[o.type];for(const t of f.toReversed())m[o.type]++,i.items$id[t.item]?.rarity==5&&(t.countInvest=m[o.type],m[o.type]=0,A&&(t.countInvestPrev=B,B=0),a.length&&!a.includes(t.item)&&(t.missed=!0));h.pools.unshift({id:o.id,name:o.name,order:i.poolsGacha.findIndex(t=>t.id==t.id),pool:o,logs:f,logs5:f.filter(t=>i.items$id[t.item]?.rarity==5),logs4:f.filter(t=>i.items$id[t.item]?.rarity==4),logsRare:f.filter(t=>i.characters$id[t.item]?.rarity>=(w?4:5)||i.lightcones$id[t.item]?.rarity>=(U?4:5)),countInvestNext:m[o.type],countInvestPrev:A,poolsSub:y.map((t,$)=>{const P=b.filter(d=>d.pool==t.id).sort((d,s)=>s.time-d.time);return{id:t.id,name:t.name,order:$,pool:t,logs:P,logs5:P.filter(d=>i.items$id[d.item]?.rarity==5),logs4:P.filter(d=>i.items$id[d.item]?.rarity==4),logsRare:P.filter(d=>i.characters$id[d.item]?.rarity>=(w?4:5)||i.lightcones$id[d.item]?.rarity>=(U?4:5))}})})}return h},H=b=>(O("data-v-db52e998"),b=b(),W(),b),Q={"gacha-summary":""},X={"value-highlight":""},Y={"value-highlight":""},Z={"value-highlight":""},ee={"value-highlight":""},te={"value-highlight":""},oe={"value-highlight":""},le={"gacha-type":""},ae=H(()=>l("p-title",null,[c("● 按"),l("span",{"value-highlight-xl":""},"跃迁类型"),c("概览")],-1)),ie={"value-highlight":""},ne={"value-highlight":""},re={"value-highlight":""},se={"gacha-type-detail":""},ue=H(()=>l("p-title",null,[c("● 按"),l("span",{"value-highlight-xl":""},"跃迁类型")],-1)),ce=["id","main"],de={key:0},he={"gacha-pool-detail":""},pe=H(()=>l("p-title",null,[c("● 按"),l("span",{"value-highlight-xl":""},"跃迁活动")],-1)),ve=["id","main"],ge={key:1},me={__name:"analysis",setup(b){const w=k(null);q(()=>D.emitChanged("mounted")),D.addTabHandle("gacha-analysis",w,s=>{const[u]=s.params;u&&P($.value=u)},D.sUseHandleInit);const U=[{value:"all",text:"全部"},{value:"character",text:"角色"},{value:"lightcone",text:"光锥"},{value:"none",text:"隐藏"}],h=k("none"),g=G(()=>h.value=="all"||h.value=="character"),m=G(()=>h.value=="all"||h.value=="lightcone"),o=[{value:!0,text:"显示"},{value:!1,text:"隐藏"}],r=k(!0),y=k(!0),p=k(!0),a=k([]),f=G(()=>a.value.filter(s=>i.lightcones$id[s.item]?.rarity==5).length),A=G(()=>a.value.filter(s=>i.characters$id[s.item]?.rarity==5).length),B=G(()=>a.value.filter(s=>i.lightcones$id[s.item]?.rarity==4).length),t=G(()=>a.value.filter(s=>i.characters$id[s.item]?.rarity==4).length),$=k(localStorage.getItem("last-analysis-uid")??""),P=async()=>{const s=$.value;w.value&&(w.value.tipsTitle=`${w.value.title} ${s}`);try{const u=z().find(e=>e.uid==s)?.logsParsed;if(!u)throw Error("找不到对应档案");a.value=u,localStorage.setItem("last-analysis-uid",s)}catch(u){E("获取抽卡记录",u)}},d=G(()=>K(a.value,g.value,m.value));return(s,u)=>(n(),v(V,null,[l("p-fixed-topbar",null,[x(R(J),{modelValue:$.value,"onUpdate:modelValue":u[0]||(u[0]=e=>$.value=e),item:"",class:"!w-48",label:"UID",type:"number",align:"center","label-split":" "},null,8,["modelValue"]),x(R(M),{item:"",class:"!w-16",text:"分析",onClick:P}),x(R(L),{modelValue:h.value,"onUpdate:modelValue":u[1]||(u[1]=e=>h.value=e),item:"",class:"!w-32",lightcone4:"",label:"四星",align:"center","align-options":"left","label-split":" ",options:U},null,8,["modelValue"]),x(R(L),{modelValue:r.value,"onUpdate:modelValue":u[2]||(u[2]=e=>r.value=e),item:"",class:"!w-32",lightcone4:"",label:"详细",align:"center","align-options":"left","label-split":" ",options:o},null,8,["modelValue"]),x(R(L),{modelValue:y.value,"onUpdate:modelValue":u[3]||(u[3]=e=>y.value=e),item:"",class:"!w-36",lightcone4:"",label:"子活动",align:"center","align-options":"left","label-split":" ",options:o},null,8,["modelValue"]),x(R(L),{modelValue:p.value,"onUpdate:modelValue":u[4]||(u[4]=e=>p.value=e),item:"",class:"!w-40",lightcone4:"",label:"新手跃迁",align:"center","align-options":"left","label-split":" ",options:o},null,8,["modelValue"])]),l("p-main-box",null,[l("p-box",Q,[l("p-gather-info",null,[c(" ● "),l("span",X,I(a.value.length),1),c(" 次抽卡， 平均 "),l("span",Y,I(((a.value.length-Object.values(d.value.typesPoolGacha).map(e=>e.countInvestNext).reduce((e,_)=>e+_,0))/(A.value+f.value)).toFixed(2)),1),c(" 抽出金 ")]),l("p-gather-info",null,[c(" ● "),l("span",Z,I(A.value),1),c(" 五星角色， "),l("span",ee,I(t.value),1),c(" 四星角色 ")]),l("p-gather-info",null,[c(" ● "),l("span",te,I(f.value),1),c(" 五星光锥， "),l("span",oe,I(B.value),1),c(" 四星光锥 ")])]),l("p-box",le,[ae,l("p-gathers",null,[(n(!0),v(V,null,C(d.value.typesPoolGacha.filter(e=>p.value?!0:e.id!=2),e=>(n(),v("p-gather",{key:`gather-type-${e.id}`},[l("p-title",null,I(e.name),1),l("p-info",null,[l("span",ie,I(e.logs.length),1),c(" 跃迁")]),l("p-info",null,[l("span",ne,I(String(e.logs5.length).padStart(2," ")),1),c(" 五星")]),l("p-info",null,[l("span",re,I(String(e.logs4.length).padStart(2," ")),1),c(" 四星")])]))),128))])]),l("p-box",se,[ue,l("p-gathers",null,[(n(!0),v(V,null,C(d.value.typesPoolGacha.filter(e=>p.value?!0:e.id!=2),e=>(n(),v("p-gather",{id:`type-detail-${e.id}`,key:`gather-type-detail-${e.id}`,main:s.brop(p.value&&e.id>10)},[x(F,{analysis:e,"shown-character-rarity4":g.value,"shown-lightcone-rarity4":m.value},null,8,["analysis","shown-character-rarity4","shown-lightcone-rarity4"]),r.value?(n(),v("p-gachas",de,[e.countInvestNext?(n(),S(T,{key:0,type:"count-invest-next","type-gacha":e.id,"count-invest":e.countInvestNext},null,8,["type-gacha","count-invest"])):N("",!0),(n(!0),v(V,null,C(e.logsRare,_=>(n(),S(T,{key:`gather-type-detail-${e.id}-${_.id}`,log:_},null,8,["log"]))),128)),e.countInvestPrev?(n(),S(T,{key:1,type:"count-invest-prev","type-gacha":e.id,"count-invest":e.countInvestPrev},null,8,["type-gacha","count-invest"])):N("",!0)])):N("",!0)],8,ce))),128))])]),l("p-box",he,[pe,l("p-gathers",null,[(n(!0),v(V,null,C(d.value.pools.filter(e=>p.value?!0:e.pool.type!=2),e=>(n(),v("p-gather",{id:`pool-detail-${e.id}`,key:`gather-pool-detail-${e.id}`,main:s.brop(e.pool.type>10)},[x(F,{analysis:e,"shown-character-rarity4":g.value,"shown-lightcone-rarity4":m.value},null,8,["analysis","shown-character-rarity4","shown-lightcone-rarity4"]),y.value&&e.poolsSub.length>1?(n(!0),v(V,{key:0},C(e.poolsSub,_=>(n(),S(F,{key:`gather-pool-sub-detail-${e.id}-${_.id}`,display:"sub",analysis:_,"shown-character-rarity4":g.value,"shown-lightcone-rarity4":m.value},null,8,["analysis","shown-character-rarity4","shown-lightcone-rarity4"]))),128)):N("",!0),r.value?(n(),v("p-gachas",ge,[e.countInvestNext?(n(),S(T,{key:0,type:"count-invest-next","type-gacha":e.pool.type,"count-invest":e.countInvestNext},null,8,["type-gacha","count-invest"])):N("",!0),(n(!0),v(V,null,C(e.logsRare,_=>(n(),S(T,{key:`gather-pool-detail-${e.id}-${_.id}`,log:_},null,8,["log"]))),128)),e.countInvestPrev?(n(),S(T,{key:1,type:"count-invest-prev","type-gacha":e.pool.type,"count-invest":e.countInvestPrev},null,8,["type-gacha","count-invest"])):N("",!0)])):N("",!0)],8,ve))),128))])])])],64))}},we=j(me,[["__scopeId","data-v-db52e998"]]);export{we as default};
